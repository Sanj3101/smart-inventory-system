<mat-drawer-container class="orders-layout">
  <mat-drawer-content>
    <mat-card class="orders-card">
      <mat-card-header class="orders-header">
        <mat-icon class="header-icon">inventory_2</mat-icon>

        <div>
          <mat-card-title>Warehouse Orders</mat-card-title>
          <mat-card-subtitle> Manage packing and shipping operations </mat-card-subtitle>
        </div>
      </mat-card-header>

      <mat-divider></mat-divider>
      <mat-tab-group animationDuration="250ms" (selectedTabChange)="onTabChange()">
        <!-- active -->
        <mat-tab>
          <ng-template mat-tab-label>
            Active Orders
            <span class="tab-count">{{ activeOrders.data.length }}</span>
          </ng-template>

          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search orders</mat-label>
            <input
              matInput
              (keyup)="applyFilter($event, 'active')"
              placeholder="Order ID, status, product..."
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <div class="table-wrapper desktop-only">
            <table
              mat-table
              [dataSource]="activeOrders"
              matSort
              #activeSort="matSort"
              multiTemplateDataRows
              *ngIf="!isMobile"
            >
              <!-- Order ID -->
              <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Order ID</th>
                <td mat-cell *matCellDef="let o">{{ o.id }}</td>
              </ng-container>

              <!-- Status -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let o" [ngClass]="getStatusClass(o.status)">
                  {{ OrderStatus[o.status] }}
                </td>
              </ng-container>

              <!-- Created -->
              <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
                <td mat-cell *matCellDef="let o">
                  {{ o.createdAt | date : 'medium' }}
                </td>
              </ng-container>

              <!-- Actions -->
              <!-- Actions -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let o">
                  <button
                    mat-raised-button
                    color="primary"
                    *ngIf="o.status === OrderStatus.Created"
                    (click)="approve(o.id)"
                  >
                    Approve
                  </button>

                  <button
                    mat-raised-button
                    color="primary"
                    *ngIf="o.status === OrderStatus.Approved"
                    (click)="pack(o.id)"
                  >
                    Pack
                  </button>

                  <button
                    mat-raised-button
                    color="accent"
                    *ngIf="o.status === OrderStatus.Packed"
                    (click)="ship(o.id)"
                  >
                    Ship
                  </button>

                  <button
                    mat-raised-button
                    color="primary"
                    *ngIf="o.status === OrderStatus.Shipped"
                    (click)="deliver(o.id)"
                  >
                    Deliver
                  </button>
                </td>
              </ng-container>

              <!-- Expand -->
              <ng-container matColumnDef="expand">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let o">
                  <button mat-icon-button (click)="openDetails(o)">
                    <mat-icon>chevron_right</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="activeColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: activeColumns"></tr>
            </table>

            <div *ngIf="activeOrders.data.length === 0" class="empty-state">No active orders.</div>
            <mat-paginator
              #activePaginator
              [pageSize]="5"
              [pageSizeOptions]="[5, 10, 20]"
              showFirstLastButtons
            >
            </mat-paginator>
          </div>
          <div class="mobile-only" *ngIf="activeOrders.filteredData.length">
            <div class="order-card" *ngFor="let o of activeOrders.filteredData">
              <div class="card-header">
                <strong>#{{ o.id }}</strong>
                <span [ngClass]="getStatusClass(o.status)">
                  {{ OrderStatus[o.status] }}
                </span>
              </div>

              <div class="card-row">
                <span>Created at: </span>
                <span>{{ o.createdAt | date : 'medium' }}</span>
              </div>

              <div class="card-actions">
                <button
                  mat-flat-button
                  color="primary"
                  *ngIf="o.status === OrderStatus.Created"
                  (click)="approve(o.id)"
                >
                  Approve
                </button>

                <button
                  mat-flat-button
                  color="primary"
                  *ngIf="o.status === OrderStatus.Approved"
                  (click)="pack(o.id)"
                >
                  Pack
                </button>

                <button
                  mat-flat-button
                  color="accent"
                  *ngIf="o.status === OrderStatus.Packed"
                  (click)="ship(o.id)"
                >
                  Ship
                </button>

                <button
                  mat-flat-button
                  color="primary"
                  *ngIf="o.status === OrderStatus.Shipped"
                  (click)="deliver(o.id)"
                >
                  Deliver
                </button>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- completed -->
        <mat-tab>
          <ng-template mat-tab-label>
            Completed Orders
            <span class="tab-count muted">{{ doneOrders.data.length }}</span>
          </ng-template>

          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search orders</mat-label>
            <input
              matInput
              (keyup)="applyFilter($event, 'done')"
              placeholder="Order ID, status, product..."
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <div class="table-wrapper desktop-only">
            <table
              mat-table
              [dataSource]="doneOrders"
              matSort
              #doneSort="matSort"
              multiTemplateDataRows
              *ngIf="!isMobile"
            >
              <!-- Expand -->
              <ng-container matColumnDef="expand">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let o">
                  <button mat-icon-button (click)="openDetails(o)">
                    <mat-icon>chevron_right</mat-icon>
                  </button>
                </td>
              </ng-container>

              <!-- Order ID -->
              <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Order ID</th>
                <td mat-cell *matCellDef="let o">{{ o.id }}</td>
              </ng-container>

              <!-- Status -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let o" [ngClass]="getStatusClass(o.status)">
                  {{ OrderStatus[o.status] }}
                </td>
              </ng-container>

              <!-- Created -->
              <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Created</th>
                <td mat-cell *matCellDef="let o">
                  {{ o.createdAt | date : 'medium' }}
                </td>
              </ng-container>

              <!-- Badge -->
              <ng-container matColumnDef="badge">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let o">
                  <span *ngIf="o.status === OrderStatus.Delivered" class="done-badge">
                    <mat-icon>check_circle</mat-icon>
                    Delivered
                  </span>

                  <span *ngIf="o.status === OrderStatus.Cancelled" class="cancelled-badge">
                    <mat-icon>cancel</mat-icon>
                    Cancelled
                  </span>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="doneColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: doneColumns"></tr>
            </table>

            <div *ngIf="doneOrders.data.length === 0" class="empty-state">
              No completed orders yet.
            </div>
            <mat-paginator
              #donePaginator
              [pageSize]="5"
              [pageSizeOptions]="[5, 10, 20]"
              showFirstLastButtons
            >
            </mat-paginator>
          </div>
          <div class="mobile-only" *ngIf="doneOrders.filteredData.length">
            <div class="order-card" *ngFor="let o of doneOrders.filteredData">
              <div class="card-header">
                <strong>#{{ o.id }}</strong>

                <span *ngIf="o.status === OrderStatus.Delivered" class="done-badge">
                  <mat-icon>check_circle</mat-icon> Done
                </span>

                <span *ngIf="o.status === OrderStatus.Cancelled" class="cancelled-badge">
                  <mat-icon>cancel</mat-icon> Cancelled
                </span>
              </div>

              <div class="card-row">
                <span>Created: </span>
                <span>{{ o.createdAt | date : 'medium' }}</span>
              </div>

              <button
                mat-stroked-button
                color="primary"
                (click)="openDetails(o)"
                class="full-width"
              >
                Details
              </button>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
  </mat-drawer-content>
  <mat-drawer #drawer position="end" class="order-drawer">
    <ng-container *ngIf="selectedOrder">
      <!-- HEADER -->
      <div class="drawer-header">
        <div>
          <h2>Order #{{ selectedOrder.id }}</h2>
          <span [ngClass]="getStatusClass(selectedOrder.status)">
            {{ OrderStatus[selectedOrder.status] }}
          </span>
        </div>

        <button mat-icon-button (click)="closeDrawer()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-divider></mat-divider>

      <!-- META -->
      <section class="meta">
        <div>
          <span class="label">Created: </span>
          <span>{{ selectedOrder.createdAt | date : 'mediumDate' }}</span>
        </div>
        <div>
          <span class="label">Items: </span>
          <span>{{ selectedOrder.items.length }}</span>
        </div>
      </section>

      <mat-divider></mat-divider>

      <!-- ITEMS -->
      <section>
        <h4>Items</h4>
        <div class="item" *ngFor="let i of selectedOrder.items">
          <span>{{ i.productName | titlecase }}</span>
          <span>Ã— {{ i.quantity }}</span>
        </div>
      </section>

      <mat-divider></mat-divider>

      <!-- ACTIONS -->
      <section class="drawer-actions">
        <button
          mat-raised-button
          color="primary"
          *ngIf="selectedOrder.status === OrderStatus.Created"
          (click)="approve(selectedOrder.id)"
        >
          Approve Order
        </button>

        <button
          mat-raised-button
          color="primary"
          *ngIf="selectedOrder.status === OrderStatus.Approved"
          (click)="pack(selectedOrder.id)"
        >
          Pack Order
        </button>

        <button
          mat-raised-button
          color="accent"
          *ngIf="selectedOrder.status === OrderStatus.Packed"
          (click)="ship(selectedOrder.id)"
        >
          Ship Order
        </button>

        <button
          mat-raised-button
          color="primary"
          *ngIf="selectedOrder.status === OrderStatus.Shipped"
          (click)="deliver(selectedOrder.id)"
        >
          Mark Delivered
        </button>
      </section>
    </ng-container>
  </mat-drawer>
</mat-drawer-container>
